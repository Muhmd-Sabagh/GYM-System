@model GYM_System.Models.Client

@{
    ViewData["Title"] = $"Client Details: {Model.Name}";
}

<h1>Client Details: @Model.Name</h1>

<div>
    <h4>Client Information</h4>
    <hr />
    <dl class="row">
        <dt class="col-sm-3">Client Code:</dt>
        <dd class="col-sm-9">@Html.DisplayFor(model => model.ClientCode)</dd>

        <dt class="col-sm-3">Name:</dt>
        <dd class="col-sm-9">@Html.DisplayFor(model => model.Name)</dd>

        <dt class="col-sm-3">Phone:</dt>
        <dd class="col-sm-9">@Html.DisplayFor(model => model.Phone)</dd>

        <dt class="col-sm-3">Email:</dt>
        <dd class="col-sm-9">@Html.DisplayFor(model => model.Email)</dd>

        <dt class="col-sm-3">Join Date:</dt>
        <dd class="col-sm-9">@Html.DisplayFor(model => model.JoinDate)</dd>

        <dt class="col-sm-3">Form Code:</dt>
        <dd class="col-sm-9">@Html.DisplayFor(model => model.FormCode)</dd>

        <dt class="col-sm-3">Subscription Status:</dt>
        <dd class="col-sm-9">
            <span class="badge @(Model.Status == GYM_System.Models.SubscriptionStatus.Active ? "bg-success" : (Model.Status == GYM_System.Models.SubscriptionStatus.Expired ? "bg-warning text-dark" : "bg-secondary"))">
                @Html.DisplayFor(model => model.Status)
            </span>
        </dd>

        <dt class="col-sm-3">Diet Status:</dt>
        <dd class="col-sm-9">@Html.DisplayFor(model => model.DietStatus)</dd>

        <dt class="col-sm-3">Workout Status:</dt>
        <dd class="col-sm-9">@Html.DisplayFor(model => model.WorkoutStatus)</dd>
    </dl>
</div>

<div class="mb-3">
    <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-info">Edit Client</a> |
    <a asp-action="Index" class="btn btn-secondary">Back to Clients List</a>
</div>

<hr />

<h3>Subscriptions</h3>

<p>
    <a asp-action="AddSubscription" asp-route-clientId="@Model.Id" class="btn btn-primary">Add New Subscription</a>
</p>

@if (Model.Subscriptions == null || !Model.Subscriptions.Any())
{
    <div class="alert alert-info">No subscriptions found for this client.</div>
}
else
{
    <table class="table table-striped table-bordered">
        <thead class="thead-dark">
            <tr>
                <th>Package Type</th>
                <th>Start Date</th>
                <th>Duration (Months)</th>
                <th>End Date</th>
                <th>Price</th>
                <th>Currency</th>
                <th>Payment Account</th>
                <th>Renewal Count</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var subscription in Model.Subscriptions.OrderByDescending(s => s.StartDate))
            {
                <tr>
                    <td>@Html.DisplayFor(modelItem => subscription.PackageType)</td>
                    <td>@Html.DisplayFor(modelItem => subscription.StartDate)</td>
                    <td>@Html.DisplayFor(modelItem => subscription.DurationMonths)</td>
                    <td>@subscription.StartDate.AddMonths(subscription.DurationMonths).ToShortDateString()</td>
                    <td>@Html.DisplayFor(modelItem => subscription.Price)</td>
                    <td>@Html.DisplayFor(modelItem => subscription.Currency)</td>
                    <td>@Html.DisplayFor(modelItem => subscription.PaymentAccount)</td>
                    <td>@Html.DisplayFor(modelItem => subscription.RenewalCount)</td>
                    <td>
                        <span class="badge @(subscription.IsActive ? "bg-success" : "bg-warning text-dark")">
                            @(subscription.IsActive ? "Active" : "Expired")
                        </span>
                    </td>
                    <td>
                        <a asp-action="EditSubscription" asp-route-id="@subscription.Id" class="btn btn-sm btn-info">Edit</a> |
                        <a asp-action="DeleteSubscription" asp-route-id="@subscription.Id" class="btn btn-sm btn-danger">Delete</a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}

<hr />

<h3>Client Assessments (First Plans)</h3>
@if (Model.ClientAssessments == null || !Model.ClientAssessments.Any())
{
    <div class="alert alert-info">No initial assessments found for this client.</div>
}
else
{
    <table class="table table-striped table-bordered">
        <thead class="thead-dark">
            <tr>
                <th>Timestamp</th>
                <th>Height (cm)</th>
                <th>Weight (kg)</th>
                <th>Age</th>
                <th>Gender</th>
                <th>Activity Level</th>
                <th>Fitness Goals</th>
                <th>Notes</th>
                <th>Image</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var assessment in Model.ClientAssessments)
            {
                <tr>
                    <td>@Html.DisplayFor(modelItem => assessment.Timestamp)</td>
                    <td>@Html.DisplayFor(modelItem => assessment.HeightCm)</td>
                    <td>@Html.DisplayFor(modelItem => assessment.WeightKg)</td>
                    <td>@Html.DisplayFor(modelItem => assessment.Age)</td>
                    <td>@Html.DisplayFor(modelItem => assessment.Gender)</td>
                    <td>@Html.DisplayFor(modelItem => assessment.ActivityLevel)</td>
                    <td>@Html.DisplayFor(modelItem => assessment.FitnessGoals)</td>
                    <td>@Html.DisplayFor(modelItem => assessment.OtherNotes)</td>
                    <td>
                        @if (!string.IsNullOrEmpty(assessment.UploadedImageUrl))
                        {
                            <a href="@assessment.UploadedImageUrl" target="_blank">View Image</a>
                        }
                        else
                        {
                            <span>No Image</span>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
}

<hr />

<h3>Client Updates</h3>
@if (Model.ClientUpdates == null || !Model.ClientUpdates.Any())
{
    <div class="alert alert-info">No updates found for this client.</div>
}
else
{
    <table class="table table-striped table-bordered">
        <thead class="thead-dark">
            <tr>
                <th>Timestamp</th>
                <th>Current Weight (kg)</th>
                <th>Physique Changes</th>
                <th>Diet Notes</th>
                <th>Exercise Notes</th>
                <th>Additional Notes</th>
                <th>Image</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var update in Model.ClientUpdates)
            {
                <tr>
                    <td>@Html.DisplayFor(modelItem => update.Timestamp)</td>
                    <td>@Html.DisplayFor(modelItem => update.CurrentWeightKg)</td>
                    <td>@Html.DisplayFor(modelItem => update.PhysiqueChanges)</td>
                    <td>@Html.DisplayFor(modelItem => update.DietAdjustmentsNotes)</td>
                    <td>@Html.DisplayFor(modelItem => update.ExerciseAdjustmentsNotes)</td>
                    <td>@Html.DisplayFor(modelItem => update.AdditionalNotes)</td>
                    <td>
                        @if (!string.IsNullOrEmpty(update.UploadedImageUrl))
                        {
                            <a href="@update.UploadedImageUrl" target="_blank">View Image</a>
                        }
                        else
                        {
                            <span>No Image</span>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
}